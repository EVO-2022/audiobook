# Caddyfile for local/internal-only access (no TLS)
# Use this if you're using Cloudflare Tunnel or only accessing internally
# To use: Copy this to Caddyfile or modify docker-compose.prod.yml to use this file

# New UI at new.rhonda.onl (when accessed via Cloudflare Tunnel)
# Note: More specific host matches must come BEFORE catch-all matchers
http://new.rhonda.onl {
    # Match everything that is NOT the new UI static files
    @backend {
        not path /*.js /*.css /*.html /
        not path /index.html
    }

    # Everything else goes to new UI static files
    @ui {
        path /*.js /*.css /*.html /
        path /index.html
    }

    # Route backend requests (API, auth, streaming) to audiobookshelf
    reverse_proxy @backend audiobookshelf:80

    # Route UI static files to new-ui nginx
    header @ui /*.js Cache-Control "no-cache, no-store, must-revalidate"
    header @ui /*.css Cache-Control "no-cache, no-store, must-revalidate"
    reverse_proxy @ui new-ui:80
}

# Main Audiobookshelf UI (catch-all for everything else on port 80)
:80 {
    reverse_proxy audiobookshelf:80
}

# Or use a local IP if accessing from other devices on your network
# Replace 192.168.1.100 with your server's local IP
# 192.168.1.100 {
#     reverse_proxy audiobookshelf:80
# }

